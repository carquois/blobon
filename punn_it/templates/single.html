{% extends "base.html" %}
{% load i18n %}
{% load thumbnail %}
{% load markup %} 

<meta name="description" content="{{ punn.author.userprofile.description }}" />

{% block open-graphs %}
    <!-- Le open graphs tags -->
    <meta property="og:title" content="{{ punn.title }}" />
    <meta property="og:url" content="{{ url }}" />
    <meta property="og:image" content="http://checkdonc.ca{{ STATIC_URL }}{{ punn.pic }}" />
    <meta property="og:site_name" content="{{ punn.author.first_name }} {{ punn.author.last_name }}" />
    <meta property="fb:admins" content="772035088" />
    <!-- Le twitter cards -->
    <meta name="twitter:card" content="photo">
    <meta name="twitter:url" content="{{ url }}">
    <meta name="twitter:title" content="{{ punn.title }}">
    <meta name="twitter:image" content="http://checkdonc.ca{{ STATIC_URL }}{{ punn.pic }}">
{% endblock %}
{% block title %}{{ punn.title }}{% endblock %}
{% block additional_analytics %}
    <!-- Le user analytics  -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', '{{ punn.author.userprofile.analytics_account }}']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
{% endblock %}
{% if punn.author.userprofile.is_obox_client %}
{% block obox %}
{% include "obox_single.html" %}
{% endblock %}
{% endif %}
{% block content %}
    <div class="container">
      <!--<div class="sharetheworld"></div>-->
      <div class="row">
        <div class="span12">
          <div class="row ">
            <div class="span7 blancBG ">
              <div style="padding-bottom:0px; background-color:#f1f1f1;">
                <script>
                  function changeImage(){
                    Dajaxice.punns.changeImage(Dajax.process, {'image':'{{ STATIC_URL }}{{ punn.pic }}'});
                  }
                  $(document).ready(function () {
                    changeImage(); 
                    $(document).keydown(function(e) {
                      var url = false;
                      if (e.which == 37) {
                        url = "{{ prev_punn.get_absolute_url }}";
                      }else if (e.which == 39) {
                        url = "{{ next_punn.get_absolute_url }}"
                      }
                      if (url) {
                        window.location = url;
                      }
                      if (e.which == 13) {
                        window.open(
                          'http://punn.it/submit/?media=http%3A%2F%2Fblobon.com%2Fi%2F{{ punn.pic|iriencode }}&url={{ punn.source|iriencode }}&title={{ punn.title|iriencode }}&is_video=false',
                          '_blank'
                        );
                      }
                    });
                  });
                </script>
                <div class="top-main-col">
                  <div id="singleTitle">
                    {{ punn.title }} 
                  </div>
                </div>
                <div class="well" style="background-color:#fff;margin-top:0px;text-align:center;">
{% if punn.youtube_id %}
                  <iframe width="640" height="360" src="http://www.youtube.com/embed/{{ punn.youtube_id }}" frameborder="0" allowfullscreen></iframe>
{% else %}
                  <a href="{{ next_punn.get_absolute_url }}"><img id="mainImage" style=max-width:685px;" src="http://i.imgur.com/Sjk3r.gif" /></a>
{% endif %}
                </div>

                {% if content %}
                <div class="well">
                  {{ content|safe }}
                </div>
                {% endif %}
              </div>


{% if auth_user.is_authenticated %}
<script type="text/javascript" charset="utf-8">
    function up(data){
        Dajaxice.punns.up(Dajax.process, {'karma':{{ punn.karma }}, 'punnid':{{ punn.id }}});
    }
    function down(data){
        Dajaxice.punns.down(Dajax.process, {'karma':{{ punn.karma }}, 'punnid':{{ punn.id }}});
    }
</script>
<button id="upbutton" class="btn" onclick="up();">Up</button>
<input type="text" value="{{ karma }}" id="karma" class="input-small">
<button id="downbutton" class="btn" onclick="down();">Down</button>
{% else %}
<a class="btn" href="{% url django.contrib.auth.views.login %}?next={{request.path}}">Up</a>
<input type="text" value="{{ karma }}" id="karma" class="input-small">
<a class="btn" href="{% url django.contrib.auth.views.login %}?next={{request.path}}">Down</a>
{% endif %}

<textarea rows="1" placeholder="{% trans 'Sumbit a comment' %}"></textarea>


                {% if comment_list %}
                  {% for comment in comment_list %}
                <div class="well">
                  {{ comment|safe }} 
                </div>
                  {% endfor %}
                {% else %}
                  <p>{% trans 'No comment. Yet...' %}</p>
                {% endif %}

{% if punn.author.userprofile.is_obox_client %}
{% include "obox_leaderboard.html" %}
{% else %}
{% include "leaderboard.html" %}
{% endif %}

            </div><!--/span7-->
{% endblock %}
{% block sidebar %}
            <div class="span5">
              <div class="box-right well">
                <div id="fleche_single">
                  <a href="{{ prev_punn.get_absolute_url }}"><div class="flecheprev">Prev</div></a>	
                  <a href="{{ next_punn.get_absolute_url }}"><div class="flechenext">Next</div></a>	
                </div>
                {% if latest_punn_list %}
                <div class="thumbnails" style="margin-left: 4px; margin-top: 9px;">
                  {% for punn in latest_punn_list %}
                  <div class="thumb_single">
                    <a class="thumbnail" href="{{ punn.get_absolute_url }}">
                    {% thumbnail punn.pic "95x115" crop="center" as im %}
                      <img class="sidebarThumbs" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                    {% endthumbnail %}
                    </a>
                  </div>
                  {% endfor %}
                </div>
                {% else %}
                  <p>No more content</p>
                {% endif %}	
              </div><!--/.well -->								   
              <div class="box-right well">
                <img src="" id="testImage" />
              </div><!--/.well -->								   
              <div class="box-right">
{% if punn.author.userprofile.is_obox_client %}
{% include "obox_primary.html" %}
{% else %}
{% include "bigbox.html" %}
{% endif %}
              </div>
              <div class="box-right">
{% if punn.author.userprofile.is_obox_client %}
{% include "obox_bigbox.html" %}
{% else %}
{% include "bigbox.html" %}
{% endif %}
              </div>
            </div><!--/span5-->
          </div><!--/row-->
        </div><!--/span12-->
      </div><!--/row-->
    </div><!--/.container-->
{% endblock %}

