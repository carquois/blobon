{% extends "base.html" %}
{% load i18n thumbnail punn_tags humanize %}
{% block open-graphs %}
    <!-- Le open graphs tags -->
    <meta property="og:title" content="{{ punn.title }}" />
    <meta property="og:url" content="{{ url }}" />
{% if punn.pic %}
                  {% thumbnail punn.pic "250x250" crop="center" as im %}
    <meta property="og:image" content="{{ im.url }}" />
                  {% endthumbnail %}
                  {% endif %}
    <meta property="og:site_name" content="{{ punn.author.first_name }} {{ punn.author.last_name }}" />
    <!-- Le twitter cards -->
    <meta name="twitter:card" content="photo">
    <meta name="twitter:url" content="{{ url }}">
    <meta name="twitter:title" content="{{ punn.title }}">
    <meta name="twitter:image" content="{{ MEDIA_URL }}{{ punn.pic }}">
    <!-- Le canonical url -->
    <link rel="canonical" href="{{ url }}" />
{% endblock %}
{% block title %} {{ punn.title }} {% endblock %}
    {% block additional_js %}
<script>
                  $(document).ready(function () {
                    $(document).keydown(function(e) {
                      if ($(e.target).is('input, textarea')) {
                      }else{
                        var url = false;
                        if (e.which == 37) {
                          url = "{{ prev_punn.get_absolute_url }}";
                        }
                        else if (e.which == 39) {
                          url = "{{ next_punn.get_absolute_url }}";
                        }
                        else if (e.which == 70) {
                          url = "{% url votes.views.up punn.id %}";
                        }
                        else if (e.which == 65) {
                          url = "{% url votes.views.down punn.id %}";
                        }
                        if (url) {
                          window.location = url;
                        }
                      }
                    });
                  });
                </script>

    {% endblock %}
    {% block additional-css %}
#nav-above-top-sidebar {
  margin-bottom: 10px;
}
#heading {
  margin-bottom: 10px;
}
#infos {
  margin-top: 10px;
  padding: 10px 25px;
}
#btn-left {
  margin-left: 10px;
}
#content-holder{
  padding: 10px;
}
.comment-holder{
  padding: 10px;
}
img{
  max-width: 720px;
}
    {% endblock %}
{% block content %} 
<div class="panel" id="content-holder">
<div class="media" id="heading">
  <a class="pull-left" href="{% url punns.views.profile_page punn.author.username %}">
{% if punn.author.userprofile.avatar %}
                  {% thumbnail punn.author.userprofile.avatar "64x64" crop="center" as im %}
                  <img src="{{ im.url }}" alt="{{ punn.author.first_name }} {{ punn.author.last_name }}" />
                  {% endthumbnail %}
                  {% endif %}    
  </a>

<div class="btn-group pull-right hidden-lg">
  <a href="{{ prev_punn.get_absolute_url }}" class="btn btn-default">&larr;</a>
  <a href="{{ next_punn.get_absolute_url }}" class="btn btn-default">&rarr;</a>
</div>

  <div class="media-body">
    <h5 class="media-heading">{{ punn.author.first_name }} {{ punn.author.last_name }} <small>@{{ punn.author.username }}</small> 
{% if punn.author.userprofile.fan_page_access_token %}
<div class="fb-like" data-href="{{ punn.author.userprofile.facebook_link }}" data-width="120" data-layout="button_count" data-show-faces="false" data-send="false"></div>
{% endif %}    
</h5>
<p class="text-muted">{% trans "Publié" %} {{ punn.pub_date|naturaltime }}{% if punn.source %} via <a href="{{ punn.source }}" target="_blank">Source</a>{% endif %}</p>
  </div>
</div>
<hr>
    <h2>{{ punn.title }}</h2>


  {% if punn.youtube_id %}
  <iframe width="480" height="360" src="http://www.youtube.com/embed/{{ punn.youtube_id }}" frameborder="0" allowfullscreen></iframe>
  {% else %}
  {% if punn.pic %}
  <a href="{{ next_punn.get_absolute_url }}">
    <img style="width: 100%;" src="{{ MEDIA_URL }}{{ punn.pic }}" alt="{{ punn.title }}" />
  </a>
  {% endif %}
  {% endif %}
  {% if content %}
<div class="well">
   <h4> {{ content|safe }}</h4>
</div>
  {% endif %}
<div id="infos" class="panel">
<div class="row">

<div class="btn-group">
<a rel="tooltip" title="{% trans "Like" %}" class="btn btn-default {% if vote == "U" %} btn-primary{% endif %}" href="
{% if request.user.is_authenticated %}
                       {% url votes.views.up punn.id %}
                     {% else %}
                       {% url django.contrib.auth.views.login %}?next={{request.path}}
                     {% endif %}
                             ">&#43;</a>
        <a class="btn btn-default" disabled="disabled">{{ karma }}</a>
        <a rel="tooltip" title="{% trans "Dislike" %}" class="btn btn-default {% if vote == "D" %}btn-primary{% endif %}" href="
{% if request.user.is_authenticated %}
                       {% url votes.views.down punn.id %}
                     {% else %}
                       {% url django.contrib.auth.views.login %}?next={{request.path}}
                     {% endif %}
                             ">&#45;</a>
</div>
<div class="pull-right">

<a href="https://twitter.com/share" class="twitter-share-button" data-lang="fr">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

<fb:like href="http://checkdonc.ca{{ punn.get_absolute_url }}" width="110" layout="button_count" show_faces="false" send="false"></fb:like>

</div>
</div>

  {% if request.user.is_staff or request.user == punn.author %}
<hr>
<div class="row">
<div class="btn-toolbar pull-right">
<div class="btn-group">
  {% if request.user.is_staff %}
  <a class="btn btn-default {% if punn.is_top %}btn-primary{% endif %}" href="{% url punns.views.hot punn.id %}"><span class="glyphicon glyphicon-fire"></span> {% trans "Hot" %}</a>
  <a class="btn btn-default" href="http://checkdonc.ca/admin/punns/punn/{{ punn.id }}"><span class="glyphicon glyphicon-pencil"></span> {% trans "Modifier" %}</a>
  {% endif %}
  {% if request.user == punn.author %}
  <a class="btn btn-danger" href="{% url punns.views.delete punn.id %}"><span class="glyphicon glyphicon-trash"></span> {% trans "Supprimer" %}</a>
  {% endif %}
</div>
</div>

</div>
  {% endif %}







  <div class="modal fade" id="delete">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">{% trans "Effacer cette page?" %}</h4>
        </div>
        <div class="modal-body">
          <p>{% trans "Êtes-vous certain de vouloir faire ça? Vous ne pourrez pas revenir en arrière par la suite." %}</p>
        </div>
        <div class="modal-footer">
<button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Non non!" %}</button>
                    <a href="{% url punns.views.delete punn.id %}" class="btn btn-danger">{% trans "Oui, je veux l'effacer" %}</a>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->




</div>
<div class="well" id="comments">

<form method="post" action="">
                      {% csrf_token %}
{{ comment_form.content.errors }}
  <div class="form-group">
{{ comment_form.content }}
  </div>


         <div class="control-group">
           <div class="controls">
{% if request.user.is_authenticated %}
                  <button rel="tooltip" title="{% trans "Soumettre votre commentaire" %}" class="btn btn-default pull-right" id="comment-submit">{% trans "Soumettre" %}</button>
                             {% else %}
<a href="{% url accounts.views.signup %}" title="{% trans "Soumettre votre commentaire" %}" class="btn btn-default pull-right" id="comment-submit">{% trans "Soumettre" %}</a>
                             {% endif %}

           </div>
         </div>
                  </form>




                {% if comment_list %}

          <h3>{% trans "Meilleur commentaire" %}</h3>

{% for comment in comment_list|dictsortreversed:"karma" %}

                {% if forloop.counter == 2 %}
                <h3>{% trans "Tous les commentaires" %}</h3>
                {% endif %}
<div class="panel comment-holder">
<div class="media">

<div class="pull-left btn-group-vertical">
        <a class="btn btn-default {% if comment.vote == "U" %}btn-primary{% endif %}" href="
                             {% if request.user.is_authenticated %}{% url votes.views.commentup comment.id %}
                             {% else %}{% url accounts.views.signup %}
                             {% endif %}
                             ">&#43;</a>
        <a class="btn btn-default" disabled="disabled">{{ comment.karma }}</a>
        <a class="btn btn-default {% if comment.vote == "D" %}btn-primary{% endif %}" href="
                             {% if request.user.is_authenticated %}{% url votes.views.commentdown comment.id %}
                             {% else %}{% url accounts.views.signup %}
                             {% endif %}
                             ">&#45;</a>
      </div>

<a href="
                             {% if request.user.is_authenticated %}{% url votes.views.commentup comment.id %}
                             {% else %}{% url accounts.views.signup %}
                             {% endif %}
                             "><div class="comment-vote comment-vote-up {% if comment.vote == "U" %}comment-vote-up-on{% endif %}"></div></a>


  <a class="pull-left" href="{% url punns.views.profile_page comment.author.username %}">
                  {% if comment.author.userprofile.avatar %}
                  {% thumbnail comment.author.userprofile.avatar "64x64" crop="center" as im %}
                  <img src="{{ im.url }}" alt="{{ comment.author.first_name }} {{ comment.author.last_name }}" class="img-rounded"/>
                  {% endthumbnail %}
                  {% endif %}
  </a>
  <div class="media-body">
    <h4 class="media-heading">{{ comment.author.first_name }} {{ comment.author.last_name }}</h4>
    {{ comment.content|safe }}
  </div>


</div>
</div>

{% endfor %}
{% endif %}

</div>
</div>

{% endblock %}

{% block topsidebar %}
<div id="nav-above-top-sidebar">
  <a href="{{ prev_punn.get_absolute_url }}" class="btn btn-default">&larr; {% trans "Préc" %}</a>
  <a href="{{ next_punn.get_absolute_url }}" class="btn btn-primary">{% trans "Proch" %} &rarr;</a>
</div>
<div class="panel">

<div class="row">



                {% if latest_punn_list %}
                  {% for punn in latest_punn_list %}
  <div class="col-xs-4">
          <a href="{{ punn.get_absolute_url }}" class="thumbnail">
                    {% thumbnail punn.pic "200x200" crop="center" as im %}
                      <img id="thumbs" src="{{ im.url }}" alt="{{ punn.title }}" />
                    {% endthumbnail %}
          </a>
</div>
                  {% endfor %}
                {% endif %}



</div>
</div>


{% endblock  %}

