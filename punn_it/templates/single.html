{% extends "base.html" %}
{% load i18n thumbnail punn_tags %}
{% block open-graphs %}
    <!-- Le open graphs tags -->
    <meta property="og:title" content="{{ punn.title }}" />
    <meta property="og:url" content="{{ url }}" />
    <meta property="og:image" content="http://checkdonc.ca{{ MEDIA_URL }}{{ punn.pic }}" />
    <meta property="og:site_name" content="{{ punn.author.first_name }} {{ punn.author.last_name }}" />
    <!-- Le twitter cards -->
    <meta name="twitter:card" content="photo">
    <meta name="twitter:url" content="{{ url }}">
    <meta name="twitter:title" content="{{ punn.title }}">
    <meta name="twitter:image" content="http://checkdonc.ca{{ MEDIA_URL }}{{ punn.pic }}">
{% endblock %}
{% block title %}{{ punn.title }}{% endblock %}
    {% block content %}
     {% if auth_user %}
      <script type="text/javascript" charset="utf-8">
        function up(data){
           Dajaxice.punns.up(Dajax.process, {'auth_userid':{{ auth_user.id }}, 'punnid':{{ punn.id }}, 'karma':{{ karma }}});
        }
        function down(data){
           Dajaxice.punns.down(Dajax.process, {'auth_userid':{{ auth_user.id }}, 'punnid':{{ punn.id }}, 'karma':{{ karma }}});
        }
      </script>
     {% endif %}
      <div id="vote-wrapper" class="visible-desktop">
       {% if not auth_user %}
        <a href="{% url django.contrib.auth.views.login %}?next={{request.path}}">
       {% endif %}
        <div id="upbutton" class="vote-up-down up{% if vote == "U" %} up-on{% endif %}" {% if auth_user %}onclick="up();"{% endif %}></div>
       {% if not auth_user %}
        </a>
       {% endif %}
        <div class="vote-up-down point"><p style="text-align:center;padding-top:17px;" id="karma">{{ karma }}</p></div>
       {% if not auth_user %}
        <a href="{% url django.contrib.auth.views.login %}?next={{request.path}}">
       {% endif %}
        <div id="downbutton" class="vote-up-down down {% if vote == "D" %} down-on{% endif %}" {% if auth_user %}onclick="down();"{% endif %}></div>
       {% if not auth_user %}
        </a>
       {% endif %}
      </div>
      <div class="container">
        <div class="row">
          <div class="span9" id="content-single">
	    <div id="content-single-wrapper">
              <h1 id="title">{{ punn.title }}</h1>
	      <div id="image-wrapper">
	       {% if punn.youtube_id %}
                <iframe src="http://www.youtube.com/embed/{{ punn.youtube_id }}" frameborder="0" allowfullscreen></iframe>
               {% else %}
	        {% if punn.pic %}
                <a href="{{ next_punn.get_absolute_url }}">
                  <img id="main-image" src="{{ MEDIA_URL }}{{ punn.pic }}" />
                </a>
	        {% endif %}
	       {% endif %}
               {% if content %}
                <div id="article-content">
                   {{ content|safe }}
                </div>
               {% endif %}
                <script>
                  $(document).ready(function () {
                    $(document).keydown(function(e) {
                      if ($(e.target).is('input, textarea')) {
                      }else{
                        var url = false;
                        if (e.which == 37) {
                          url = "{{ prev_punn.get_absolute_url }}";
                        }else if (e.which == 39) {
                          url = "{{ next_punn.get_absolute_url }}";
                        }else if (e.which == 82) {
                          url = "{% url punns.views.random %}"; 
                        }
                        if (url) {
                          window.location = url;
                        }
                        if (e.which == 70) {
                          up(); 
                        }
                        if (e.which == 65) {
                          down(); 
                        }
                        if (e.which == 67) {
                          $("#comment-box").focus();
			  return false;
                        }
                      }
                    });
                  });
                  jQuery(function($){
                    $('#comment-box').focus(function(){
                      $(this).attr('rows',5);
		      return false;
                    }).blur(function(){
                      $(this).attr('rows',1);
		      return false;
                    });
                  }); 
                </script>
                <textarea id="comment-box" rows="1" placeholder="{% trans "Soumettre un commentaire..." %}"></textarea>
                
                
                <!-- INSÃ‰REZ LES COMMENTS ICI -->
                <div id="best-comment"> Meilleur commentaire </div> 
                <div id="comment-wrapper">   
                  <div id="vote-comment-wrapper">
                    <div class="comment-vote comment-vote-up"></div>
                    <p id="comment-score">543</p>
                    <div class="comment-vote comment-vote-down"></div>
                  </div>                    
                  <div id="comment-author-avatar">
                    <img src="http://i.imgur.com/Ce2mlR3s.jpg">
                  </div>
                  <div id="comment-right-column">
                    <div id="username-comment">RoccoSiffredi69</div>
                    <p id="comment-hours">10 hours ago</p>
                    <br />
                    <div id="comment">
                      <p>I don't get what these hate comments are about!!!</p>
                    </div>
                </div>
                <!-- FIN COMMENT -->
                
                
                {% if comment_list %}
                <div id="comments">
                 {% for comment in comment_list|dictsortreversed:"karma" %}
                    {% if forloop.first %}
                      <p class="comment-title">{% trans "Meilleur commentaire" %}</p> 
                      <hr>
                      <div class="comment-vote comment-vote-up"></div> 
                      <!--<div class="comment-vote comment-vote-up-on"></div>-->
                      <div class="comment-vote comment-vote-down"></div> 
                      <!--<div class="comment-vote comment-vote-down-on"></div>-->
					  <img id="comment-author-avatar" src="{{ MEDIA_URL }}{{ comment.author.userprofile.avatar }}" />                      
                      {{ comment.content|safe }}
                    {% else %}
                      {% if forloop.counter == 2 %}
                      <p class="comment-title">{% trans "Tous les commentaires" %}</p> 
                      <hr style="border-top: 1px solid lightgray;">
                      {{ comment.content|safe }}
                      <hr style="border-top: 1px solid lightgray;">
                      {% else %}
                      {{ comment.content|safe }}
                      <hr style="border-top: 1px solid lightgray;">
                      {% endif %}
                    {% endif %}
                  {% endfor %}
                </div>
                {% endif %}
              </div>
           </div>
         </div>
      </div> <!-- /container -->
     {% endblock %}
